# 项目分工表格

| 姓名   | 学号     | 班级         | 任务 | 权重 |
| ------ | -------- | ------------ | ---- | ---- |
| 陈俊杉 | 31602037 | 软件工程1602 | 全栈 | 1.0  |

# 自我评估表

| 函数式编程                        | 4    |
| --------------------------------- | ---- |
| fetch   api                       | 4    |
| FRP                               | 1    |
| session   Storage                 | 5    |
| 响应式设计(Desktop/Tablet/Mobile) | 3    |
| REST   API                        | 4    |
| 前端开发                          | 5    |

# 项目说明

​	Express + node.js + mongoDB

​	Express 是一个简洁而灵活的 [node.js](https://baike.baidu.com/item/node.js) Web应用框架, 提供一系列强大特性帮助你创建各种Web应用。Express 不对 node.js 已有的特性进行二次抽象，我们只是在它之上扩展了Web应用所需的功能。丰富的HTTP工具以及来自Connect框架的中间件随取随用，创建强健、友好的API变得快速又简单

​	在不同的模块中实现了不同的内容。     

​	在用户模块中，实现了登录、注册、找回密码。

​	在管理模块中，实现了实现了新闻和英雄的增，删，改，查功能。 

​	在用户操作过程中使用了了MD5（Message-Digest Algorithm）是计算机安全领域广泛使用的散列函数（又称哈希算法、摘要算法），主要用来确保消息的完整和一致性。常见的应用场景有密码保护、下载文件校验等。

# 解决技术要点说明

 

## ·解决  添加数据 问题 1， 关键代码与步骤如下

```
router.post('/newAdd', function (req, res, next) {
    var photo = /\.jpg$|\.jpeg$|\.gif$/i
    if(!photo.test(req.body.newssrc)){
        res.json({status: 1, message: '请使用jpg、jpeg、gif格式的图片'})
        photo.focus();
        return false;
    };
    if (!req.body.username) {
        res.json({status: 1, message: "用户名为空"})
    }
    if (!req.body.token) {
        res.json({status: 1, message: "登录出错"})
    }
    if (!req.body.id) {
        res.json({status: 1, message: "用户传递错误"})
    }
    if (!req.body.newsname) {
        res.json({status: 1, message: "新闻名称为空"})
    }
    if (!req.body.newssrc) {
        res.json({status: 1, message: "新闻图片为空"})
    }
    if (!req.body.newstype) {
        res.json({status: 1, message: "新闻类型为空"})
    }
    if (!req.body.newstime) {
        res.json({status: 1, message: "新闻时间为空"})
    }
    //验证
    var check = checkAdminPower(req.body.username, req.body.token, req.body.id)
    if (check.error == 0) {
        //    验证用户的情况下
        user.findByUsername(req.body.username, function (err, findUser) {
            if (findUser[0].userAdmin && !findUser[0].userStop) {
            var saveNew = new newsmsg({
                    newsname: req.body.newsname,
                    newstype: req.body.newstype,
                   newstime: req.body.newstime,
                    newssrc: req.body.newssrc
                })
                saveNew.save(function (err) {
                    if (err) {
                        res.json({status: 1, message: err})
                    } else {
                        res.json({status: 0, message: "添加成功"})
                    }
                })
            } else {
                res.json({error: 1, message: "用户没有获得权限或者已经停用"})
            }
        })

    } else {
        res.json({status: 1, message: check.message})
    }
});
```

​	需要先验证用户是否登入，之后再检查他的token值，在然后检测其是否有权限进行添加，保证了普通用户，即使进入了此界面也无法操作。

## ·解决 验证id 问题2， 关键码与步骤如下

```
function getMD5Password(id) {

    var md5 = crypto.createHash('md5');

    var token_before = id + init_token

    // res.json(userSave[0]._id)

    return md5.update(token_before).digest('hex')

}
```

​	我这使用的是MD5进行校验

 

## ·解决  数据正则验证 问题 3，手机和邮箱的正则表达式验证

```
router.post('/register', function (req, res, next) {
    if (!req.body.username) {
        res.json({status: 1, message: "用户名为空"})
    }
    if (!req.body.password) {
        res.json({status: 1, message: "密码为空"})
    }
    if (!req.body.userMail) {
        res.json({status: 1, message: "用户邮箱为空"})
    }
    if (!req.body.userPhone) {
        res.json({status: 1, message: "用户手机为空"})
    }
	var myreg = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
	if(!myreg.test(req.body.userMail)){
	    res.json({status: 1, message: '请输入有效的E_mail！'})
	    myreg.focus();
	    return false;
	};
	var mobile1 =/^1[3456789]\d{9}$/;
	if(!mobile1.test(req.body.userPhone)){
	    res.json({status: 1, message: '请输入正确的11位手机号'})
	    mobile1.focus();
	    return false;
	};
    user.findByUsername(req.body.username, function (err, userSave) {
        if (userSave.length != 0) {
            // res.json(userSave)
            res.json({status: 1, message: "用户已注册"})
        } else {
            var registerUser = new user({
                username: req.body.username,
                password: req.body.password,
                userMail: req.body.userMail,
                userPhone: req.body.userPhone,
				userAdmin: 0,
				userPower: 0,
				userStop: 0
            })
            registerUser.save(function () {
                res.json({status: 0, message: "注册成功"})
            })
        }
    })

});
```

​     在注册功能中，对邮箱和手机号进行了正则表达式的检测。

## ·解决  密码找回 问题 5，密码找回的验证

```
//用户找回密码
router.post('/findPassword', function (req, res, next) {
//    需要输入用户的邮箱信息和手机信息，同时可以更新密码
    if (req.body.repassword) {
         { // 直接验证mail和phone
            user.findUserPassword(req.body.username, req.body.userMail, req.body.userPhone, function (err, userFound) {
                if (userFound.length != 0) {
                    user.update({_id: userFound[0]._id}, {password: req.body.repassword}, function (err, userUpdate) {
                        if (err) {
                            res.json({status: 1, message: "更改错误", data: err})
                        }
                        res.json({status: 0, message: '更改成功', data: userUpdate})
                    })
                } else {
                    res.json({status: 1, message: "信息错误"})
                }
            })
        }
    } else {
        //    这里只是验证mail和phone，为了前台验证，返回验证成功和所有的字段，改密码使用或者认证失败
        if (!req.body.username) {
            res.json({status: 1, message: "用户名称为空"})
        }
        if (!req.body.userMail) {
            res.json({status: 1, message: "用户邮箱为空"})
        }
        if (!req.body.userPhone) {
            res.json({status: 1, message: "用户手机为空"})
        }
        user.findUserPassword(req.body.username, req.body.userMail, req.body.userPhone, function (err, userFound) {
            if (userFound.length != 0) {
                res.json({
                    status: 0,
                    message: "验证成功，请修改密码",
                    data: {username: req.body.username, userMail: req.body.userMail, userPhone: req.body.userPhone}
                })
            } else {
                res.json({status: 1, message: "信息错误"})
            }
        })
    }
});
```

​     在密码找回的功能中，对用户名，邮箱，手机号进行了验证。

#  心得体会（结合自己情况具体说明）

 

## · 大项目开发过程心得

​     项目的后台开发比较的简陋。功能相对于前端可能有点太少了。主要是对于node.js运用的不熟悉，使用express还捣鼓了半天，最后通过CSDN才解决了问题。对于后台代码的编写，主要通过书上所给的demo进行模仿修改。用了三周多的时间进行前后端的开发，让我发现了自己还有许多的不足之处，在平常时候所编写的代码实在太少，导致到了最后的时间我才匆匆忙忙的开始制作。我一定吸取此次的教训，在之后的实习中将js所欠缺的东西补全。

 

## · 遇到哪些困难，经历哪里过程，有哪些收获

​	最早遇到的困难是因为只是的匮乏，导致我不知如何下手，在将后几章的内容看完后才开始制作。

​	之后前端的开发感觉十分的轻松，但对于后端的开发就感觉十分的困难。在知乎和CSDN搜索之后，我才决定使用node.js+vue+express+MongoDB来对项目进行开发。

​	之后就是学习数据的发送与接收，对post和get有所了解，刚开始打算使用的是axios的方式进行发送，之后发现http的发送方式也是简单，所以之后就改用了http的请求方式进行数据的传递。vue中的$http服务  需要引入一个叫vue-resource.js的文件，因为vue.js中没有$http服务。如果需要使用这个服务去百度下载vue-resource.js 然后引进项目即可。十分的便捷，一般的项目生成时都会自带http的数据请求方式。

​	最后就是数据的一些格式问题，发送的数据常常是缺胳膊少腿的，在postman中经过了好几天的调试才把所用的功能全部检测完毕。

#  · 本课程建议

​    优点：

 	首先觉得课程内容是十分丰富的，老师也会在课上讲解一些现在热门的一些技术和方法，让我从中获取了很多的知识。每周都有一个实验作业，每三周就有一个项目实战，作业的量刚刚好，不会出现一整周都在做一门课作业的情况，也让我们的在代码的实现中有了经验，对于后面的学习有一定的帮助。

​	不足：

​	希望老师能够在作业结束后的课程中，讲解一下实验之中的难点，并解析。添加一些课堂的练习，让我们知道一下我们每个阶段有哪些的不足之处，可以及时的发现并补上相应的知识。

​	